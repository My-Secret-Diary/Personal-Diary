<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Secret Diary</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Quicksand', sans-serif;
    background-color: #f4f7fb;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    transition: background 0.3s ease;
  }
  #login, #app {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    padding: 30px;
    width: 360px;
    max-width: 90%;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  input, textarea, button {
    width: 100%;
    margin-top: 10px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    outline: none;
    font-size: 15px;
    font-family: inherit;
  }
  button {
    background-color: #4a90e2;
    color: white;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background-color: #357abd;
  }
  textarea {
    height: 200px;
    resize: none;
  }
  #app {
    display: none;
    flex-direction: column;
    gap: 10px;
  }
  #datePicker {
    width: 100%;
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <h1>ðŸ”’ My Secret Diary</h1>
  <p>Enter your diary password</p>
  <input type="password" id="passwordInput" placeholder="Password">
  <button id="loginBtn">Login</button>
</div>

<!-- APP (hidden by default) -->
<div id="app">
  <h1 id="diaryTitle">My Secret Diary</h1>
  <input type="date" id="datePicker">
  <textarea id="entryText" placeholder="Start writing your thoughts..."></textarea>
  <button id="saveBtn">ðŸ’¾ Save Entry</button>
  <button id="changePassBtn" style="background-color:#f66;">Change Password</button>
  <button id="renameBtn" style="background-color:#6c6;">Rename Diary</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDRpLl01xtSZ7f0ZbId7zFASUJoem4L69s",
  authDomain: "my-secret-diary-9b62c.firebaseapp.com",
  projectId: "my-secret-diary-9b62c",
  storageBucket: "my-secret-diary-9b62c.firebasestorage.app",
  messagingSenderId: "139353851381",
  appId: "1:139353851381:web:3050a47540d36a2243ccbc"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// DOM elements
const loginDiv = document.getElementById("login");
const appDiv = document.getElementById("app");
const passwordInput = document.getElementById("passwordInput");
const loginBtn = document.getElementById("loginBtn");
const diaryTitle = document.getElementById("diaryTitle");
const datePicker = document.getElementById("datePicker");
const entryText = document.getElementById("entryText");
const saveBtn = document.getElementById("saveBtn");
const changePassBtn = document.getElementById("changePassBtn");
const renameBtn = document.getElementById("renameBtn");

// Vars
let currentPassword = "53458678";
let diaryName = "My Secret Diary";

// Load settings
async function loadSettings() {
  try {
    const settingsDoc = await getDoc(doc(db, "entries", "settings"));
    if (settingsDoc.exists()) {
      const data = settingsDoc.data();
      currentPassword = data.password || currentPassword;
      diaryName = data.name || diaryName;
      diaryTitle.textContent = diaryName;
    } else {
      await setDoc(doc(db, "entries", "settings"), {
        password: currentPassword,
        name: diaryName
      });
    }
  } catch (err) {
    alert("âš ï¸ Failed to connect to diary database.");
  }
}
await loadSettings();

// LOGIN
loginBtn.onclick = async () => {
  if (passwordInput.value === currentPassword) {
    // smooth transition
    loginDiv.style.opacity = 0;
    setTimeout(() => {
      loginDiv.style.display = "none";
      appDiv.style.display = "flex";
      datePicker.valueAsDate = new Date();
      loadEntry();
    }, 400);
  } else {
    alert("Wrong password!");
  }
};

// Load diary entry
async function loadEntry() {
  const date = datePicker.value;
  if (!date) return;
  const entryDoc = await getDoc(doc(db, "entries", date));
  entryText.value = entryDoc.exists() ? entryDoc.data().text : "";
}

// Save entry
saveBtn.onclick = async () => {
  const date = datePicker.value;
  const text = entryText.value;
  await setDoc(doc(db, "entries", date), { text });
  alert("Saved!");
};

// Change password
changePassBtn.onclick = async () => {
  const newPass = prompt("Enter new password:");
  if (newPass && newPass.trim() !== "") {
    currentPassword = newPass;
    await setDoc(doc(db, "entries", "settings"), {
      password: currentPassword,
      name: diaryName
    });
    alert("Password changed!");
  }
};

// Rename diary
renameBtn.onclick = async () => {
  const newName = prompt("Enter new diary name:");
  if (newName && newName.trim() !== "") {
    diaryName = newName;
    diaryTitle.textContent = diaryName;
    await setDoc(doc(db, "entries", "settings"), {
      password: currentPassword,
      name: diaryName
    });
    alert("Diary renamed!");
  }
};

datePicker.onchange = loadEntry;
</script>

</body>
</html>
